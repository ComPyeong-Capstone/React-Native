platform :ios, '16.0'  # âœ… iOS ìµœì†Œ ì§€ì› ë²„ì „ ìœ ì§€

require_relative '../node_modules/react-native/scripts/react_native_pods'

# âœ… New Architecture í™œì„±í™” ê°€ëŠ¥ (í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì„¤ì •)
ENV['RCT_NEW_ARCH_ENABLED'] = '0'  # ğŸ”„ '1' â '0'ìœ¼ë¡œ ë³€ê²½ (ì¼ë‹¨ ë¹„í™œì„±í™” í›„ í…ŒìŠ¤íŠ¸)

prepare_react_native_project!

target 'front4' do
  config = use_native_modules!

  use_react_native!(
    :path => config[:reactNativePath],
    :hermes_enabled => false,  # âŒ Hermes ë¹„í™œì„±í™” (JSC ì‚¬ìš©)
    :app_path => "#{Pod::Config.instance.installation_root}/.."
  )

  # âœ… `use_frameworks!` ì„¤ì • ì‚­ì œ (RNì€ ê¸°ë³¸ì ìœ¼ë¡œ static library ì‚¬ìš©)
  # âœ… `use_modular_headers!` ì„¤ì •ë„ ì‚­ì œ
  # use_frameworks! :linkage => :static
  # use_modular_headers!

  # âœ… íŠ¹ì • Podë§Œ `static_library` ì„¤ì • (New Architecture ê´€ë ¨ ë¬¸ì œ í•´ê²°)
  pre_install do |installer|
    installer.pod_targets.each do |pod|
      if pod.name.start_with?('React', 'RCT', 'Yoga', 'FBLazyVector', 'FBReactNativeSpec', 'RCTTypeSafety', 'React-Core', 'ReactCommon', 'React-jsinspector', 'glog', 'boost', 'folly')
        def pod.build_type
          Pod::BuildType.static_library
        end
      end
    end
  end

  post_install do |installer|
    react_native_post_install(
      installer,
      config[:reactNativePath],
      :mac_catalyst_enabled => false
    )

    # âœ… Xcode 15+ í™˜ê²½ì—ì„œ 'Multiple commands produce' ë¬¸ì œ í•´ê²°
    installer.pods_project.targets.each do |target|
      target.build_configurations.each do |config|
        config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'NO'  # ğŸ”„ 'YES' â 'NO'ë¡œ ë³€ê²½
        config.build_settings['EXCLUDED_ARCHS[sdk=iphonesimulator*]'] = 'arm64'  # âŒ iOS Simulatorì—ì„œ arm64 ë¹Œë“œ ë°©ì§€
      end
    end
  end
end
